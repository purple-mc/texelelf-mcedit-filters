from pymclevel import TAG_Byte
from pymclevel import Entity

displayName = "Ani's Invulnerability Filter"

entity_types =	("All","Mobs","Entities")
entity_list =	("Any","ItemFrame","Painting","Arrow","Snowball","Fireball","SmallFireball","WitherSkull","FireworksRocketEntity","ThrownEnderpearl",
				"ThrownPotion","ThrownExpBottle","Item","XPOrb","EyeOfEnderSignal","EnderCrystal",
				"MinecartChest","MinecartFurnace","MinecartHopper","MinecartRideable","MinecartTNT","Boat","PrimedTnt","FallingSand")

mob_list = 		("Any","Bat","Blaze","CaveSpider","Chicken","Cow","Creeper","EnderDragon",
				"Enderman","Ghast","Giant","LavaSlime","MushroomCow","Ozelot","Pig","PigZombie",
				"Sheep","Silverfish","Skeleton","Slime","SnowMan","Spider","Squid",
				"Villager","VillagerGolem","Witch","WitherBoss","Wolf","Zombie",)

inputs = (
	("Apply only to:",entity_types),
	("Mob Type:",mob_list),
	("Entity Type:",entity_list),
	("Is Invulnerable:", True),
	)
def perform(level, box, options):
	isinv = options["Is Invulnerable:"]
	applyto = options["Apply only to:"]
	mobtype = options["Mob Type:"]
	entitytype = options["Entity Type:"]

	for (chunk, slices, point) in level.getChunkSlices(box):
		for e in chunk.Entities:
			x = e["Pos"][0].value
			y = e["Pos"][1].value
			z = e["Pos"][2].value
			
			if x >= box.minx and x < box.maxx and y >= box.miny and y < box.maxy and z >= box.minz and z < box.maxz:
				if applyto != "All":
					if applyto == "Mobs":
						if e["id"].value not in mob_list:
							continue
						if mobtype != "Any" and e["id"].value != mobtype:
							continue
					elif applyto == "Entities":
						if e["id"].value not in entity_list:
							continue
						if entitytype != "Any" and e["id"].value != entitytype:
							continue
				e["Invulnerable"] = TAG_Byte(isinv)
				chunk.dirty = True